<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Donation Receipt - Kind-Kart</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-light">

<!-- ✅ Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm py-3">
  <div class="container">
    <a class="navbar-brand fw-bold d-flex align-items-center" href="main.html">
      <img src="images/logo.png" alt="Kind-Kart Logo" height="40" class="me-2">
      Kind-Kart
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto align-items-center">
        <li class="nav-item"><a class="nav-link" href="main.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="cause.html">Causes</a></li>
        <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
        <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
        <li class="nav-item"><a class="nav-link" href="donate.html">Donate Now</a></li>
        <li class="nav-item ms-2">
          <button class="btn btn-outline-secondary position-relative" type="button" data-bs-toggle="offcanvas" data-bs-target="#cartOffcanvas">
            <i class="bi bi-cart3 me-1"></i> Kind-Cart
            <span id="cart-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
          </button>
        </li>
        <li class="nav-item ms-2"><a class="btn btn-outline-primary" href="login.html"><i class="bi bi-box-arrow-in-right me-1"></i> Login</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- ✅ Receipt Section -->
<div class="container py-5">
  <div class="card shadow-lg">
    <div class="card-header bg-success text-white text-center">
      <h3 class="mb-0">✅ Payment Successful</h3>
    </div>
    <div class="card-body" id="receiptBody">
      <p class="text-center text-muted">Loading receipt...</p>
    </div>
    <div class="card-footer text-center">
      <button class="btn btn-primary me-2" onclick="window.location.href='main.html'">
        <i class="bi bi-house"></i> Back to Home
      </button>
      <button class="btn btn-outline-secondary" onclick="window.print()">
        <i class="bi bi-printer"></i> Print Receipt
      </button>
    </div>
  </div>
</div>

<!-- ✅ Footer -->
<footer class="bg-dark text-white text-center py-3">
  <p class="mb-0">&copy; 2025 Kind-Kart | All Rights Reserved</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- ✅ Replace Login with Profile Dropdown if Logged In -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const user = JSON.parse(localStorage.getItem('kk_user') || 'null');
  const nav = document.querySelector('.navbar .navbar-nav');
  if (!nav) return;

  const loginBtn = nav.querySelector('a[href="login.html"]')?.closest('li');
  if (user && loginBtn) {
    const li = document.createElement('li');
    li.className = 'nav-item dropdown ms-2';
    li.innerHTML = `
      <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
        <img src="${user.photo_url || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(user.name || user.email)}" 
             alt="avatar" class="rounded-circle me-2" style="width:28px;height:28px;object-fit:cover;"> 
        <span>${user.name || user.email}</span>
      </a>
      <ul class="dropdown-menu dropdown-menu-end">
        <li><a class="dropdown-item" href="profile.html">Profile</a></li>
        <li><a class="dropdown-item" href="donation_history.html">My Donations</a></li>
        <li><hr class="dropdown-divider"></li>
        <li><button class="dropdown-item" id="kk-logout">Logout</button></li>
      </ul>
    `;
    loginBtn.replaceWith(li);

    document.getElementById('kk-logout')?.addEventListener('click', () => {
      localStorage.removeItem('kk_user');
      window.location.reload();
    });
  }
});
</script>

<!-- ✅ Load Receipt -->
<script>
const receipt = JSON.parse(localStorage.getItem("kk_receipt") || "null");

if (receipt) {
  const body = document.getElementById("receiptBody");
  body.innerHTML = `
    <h5 class="text-center mb-4">Thank you for your donation ❤️</h5>
    <p><strong>Transaction ID:</strong> ${receipt.transactionId}</p>
    <p><strong>Payment Method:</strong> ${receipt.paymentMethod}</p>
    <p><strong>Date & Time:</strong> ${receipt.date}</p>
    <p><strong>Total Amount:</strong> ₹${receipt.amount}</p>
    ${receipt.items && receipt.items.length ? `
      <h6 class="mt-3">Items Donated:</h6>
      <ul class="list-group mb-3">
        ${receipt.items.map(i => `<li class="list-group-item">
          ${i.name} (x${i.qty || 1}) - ₹${i.price}
        </li>`).join("")}
      </ul>
    ` : ""}
  `;
  // Clear receipt after showing
  localStorage.removeItem("kk_receipt");
}
</script>

</body>
</html>
